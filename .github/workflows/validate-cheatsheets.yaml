name: Validate Cheatsheet Links

on:
  schedule:
    - cron: '0 6 * * *'  # daily at 6am UTC
  workflow_dispatch:
jobs:
  validate:
    runs-on: ubuntu-latest
    outputs:
      result: ${{ steps.check.outputs.result }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - id: check
        name: Validate core.js
        run: |
          cheatsheets=$(awk '/const cheatsheets = \[/, /\]/{ print }' core.js \
            | grep -v '//NEW-CHEATSHEET' \
            | grep -o '"[^"]\+"' \
            | sed 's/"//g')

          missing=0
          for sheet in $cheatsheets; do
            file="cheatsheets/${sheet}.html"
            if [ ! -f "$file" ]; then
              echo "Missing: $file"
              missing=1
            fi
          done

          if [ "$missing" -eq 0 ]; then
            echo "âœ… Valid"
            echo "result=valid" >> $GITHUB_OUTPUT
          else
            echo "âŒ Invalid"
            echo "result=invalid" >> $GITHUB_OUTPUT
          fi

  on-valid:
    needs: validate
    if: needs.validate.outputs.result == 'valid'
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ All cheatsheets are valid!"

  on-invalid:
    needs: validate
    if: needs.validate.outputs.result == 'invalid'
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸš¨ Missing cheatsheet(s)! Time to generate more."
